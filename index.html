<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Generador de Certificado</title>

<!-- EB Garamond (Nombre) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@1,400&display=swap" rel="stylesheet">

<!-- Montserrat (Fecha) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap" rel="stylesheet">

<!-- LIBRERÍAS ESTABLES (SEPARADAS) -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
:root{
  --page-w:1123px;
  --page-h:794px;
}

*{box-sizing:border-box}

body{
  margin:0;
  padding:20px;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:#0b0d10;
}

.app{
  max-width:1100px;
  margin:auto;
  display:grid;
  grid-template-columns:380px 1fr;
  gap:18px;
}

.panel{
  background:#fff;
  padding:16px;
  border-radius:16px;
}

label{font-size:12px;display:block;margin-top:12px}
input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #ddd;
}

button{
  margin-top:14px;
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  background:#111;
  color:#fff;
  cursor:pointer;
}

.viewport{
  overflow:auto;
  background:#111;
  padding:10px;
  border-radius:16px;
}

#stage{transform-origin:top left}

#certificate{
  width:var(--page-w);
  height:var(--page-h);
  position:relative;
  background:#fff;
}

#certificate img{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
}

#nameText{
  position:absolute;
  top:315px;
  left:50%;
  transform:translateX(-50%);
  font-family:"EB Garamond",serif;
  font-style:italic;
  font-weight:400;
  font-size:56px;
  color:#2a2a2a;
  max-width:86%;
  text-align:center;
  white-space:nowrap;
}

#dateText{
  position:absolute;
  top:530px;
  left:50%;
  transform:translateX(-50%);
  font-family:"Montserrat",sans-serif;
  font-weight:500;
  font-size:21px;
  color:#2a2a2a;
}

@media(max-width:980px){
  .app{grid-template-columns:1fr}
}
</style>
</head>

<body>

<div class="app">

  <div class="panel">
    <label>Nombre</label>
    <input id="nameInput" placeholder="Nicolás Sosa Calle">

    <label>Fecha</label>
    <input id="dateInput" value="Lima, 9 de Febrero del 2026">

    <button id="btnPdf">Generar PDF</button>
  </div>

  <div class="viewport" id="viewport">
    <div id="stage">
      <div id="certificate">
        <img src="background.jpg" crossorigin="anonymous">
        <div id="nameText">Nombre Apellido</div>
        <div id="dateText">Lima, 9 de Febrero del 2026</div>
      </div>
    </div>
  </div>

</div>

<script>
const nameInput=document.getElementById("nameInput");
const dateInput=document.getElementById("dateInput");
const nameText=document.getElementById("nameText");
const dateText=document.getElementById("dateText");
const btnPdf=document.getElementById("btnPdf");
const cert=document.getElementById("certificate");
const stage=document.getElementById("stage");
const viewport=document.getElementById("viewport");

function clean(v){return(v||"").trim().replace(/\s+/g," ")}

function fitName(){
  let s=56;
  nameText.style.fontSize=s+"px";
  while(nameText.scrollWidth>nameText.clientWidth&&s>38){
    s--;
    nameText.style.fontSize=s+"px";
  }
}

function scalePreview(){
  const scale=Math.min(1,viewport.clientWidth/1123);
  stage.style.transform=`scale(${scale})`;
}
window.addEventListener("resize",scalePreview);
scalePreview();

nameInput.oninput=()=>{
  nameText.textContent=clean(nameInput.value)||"—";
  fitName();
};
dateInput.oninput=()=>dateText.textContent=clean(dateInput.value)||"—";

btnPdf.onclick=async()=>{
  // quitar scale solo para exportar
  const prev=stage.style.transform;
  stage.style.transform="scale(1)";
  await new Promise(r=>requestAnimationFrame(()=>requestAnimationFrame(r)));

  const isMobile=window.innerWidth<980;
  const canvasScale=isMobile?1.25:2;

  const canvas=await html2canvas(cert,{
    scale:canvasScale,
    useCORS:true,
    backgroundColor:"#fff"
  });

  const img=canvas.toDataURL("image/jpeg",0.98);
  const { jsPDF }=window.jspdf;
  const pdf=new jsPDF({orientation:"landscape",unit:"mm",format:"a4"});
  pdf.addImage(img,"JPEG",0,0,297,210);
  pdf.save(`Certificado_${clean(nameInput.value)||"Alumno"}.pdf`);

  stage.style.transform=prev;
};
</script>

</body>
</html>
